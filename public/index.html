<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>
<body>
<div id="form_container">
  <form id="payment">
    <fieldset>
      <input name="environment_key" type="hidden" value="COS96v2dy5hJ5V7kQJHBsqolQG7" />

      <label for="credit_card_first_name">First name</label>
      <input id="credit_card_first_name" name="credit_card[first_name]" type="text" />

      <label for="credit_card_last_name">Last name</label>
      <input id="credit_card_last_name" name="credit_card[last_name]" type="text" />

      <label for="credit_card_number">Card Number</label>
      <input id="credit_card_number" name="credit_card[number]" type="text" />

      <label for="credit_card_verification_value">Security Code</label>
      <input id="credit_card_verification_value" name="credit_card[verification_value]" type="text" />

      <label for="credit_card_month">Expires on</label>
      <input id="credit_card_month" name="credit_card[month]" type="text" />
      <input id="credit_card_year" name="credit_card[year]" type="text" />

      <button id="submitButton" >Submit Payment</button>
    </fieldset>
  </form>
</div>


<script type="text/javascript">
  $("form#payment").submit(function() {
    console.log("test");
    var iframe = $("<iframe id='iframe' style='display: none;'></iframe>");
    var form = $("#form_container").html();

    $("body").append(iframe);
    $('#iframe').contents().find('html').html(form);
    $("input").each(function(index, input) {
      $('#iframe').contents().find('#' + $(input).attr('id')).val($(input).val());
    });
    $('#iframe').contents().find('form').attr("action", 'https://core.spreedly.com/v1/payment_methods');
    $('#iframe').contents().find('form').attr("method", 'POST');
    $('#iframe').contents().find('form').append('<input name="redirect_url" type="hidden" value="http://local.milyoni.net:3000/response" />');
    $('#iframe').contents().find('form').submit();
    setTimeout(function() {
      $("body").append($('#iframe').contents().find('html').html());
      console.info("RESULTS", $('#iframe').contents().find('html').html());
    }, 1000);
    return false;
  });


  //    <input name="redirect_url" type="hidden" value="http://spreedly-test.herokuapp.com/response.html" />
  //  action="https://core.spreedly.com/v1/payment_methods" method="POST"
</script>
</body>
</html>

